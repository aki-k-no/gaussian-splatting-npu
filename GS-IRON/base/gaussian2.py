import struct

# -------------------------
# 1つ目のガウス（あなたが貼ったもの）
# -------------------------
g1 = {
    "x": -0.05,
    "y": 1.5,
    "z": -2,
    "nx": 0.0,
    "ny": 0.0,
    "nz": 0.0,
    "f_dc_0": 3.790736,
    "f_dc_1": 0.610315,
    "f_dc_2": 1.0232366,
    **{f"f_rest_{i}": v for i, v in enumerate([
        0.102161, -0.0444992, -0.00155531, 0.0192851, -0.0934443,
        -0.0347244, 0.0230737, -0.01146, -0.0111902, 0.00690077,
        -0.00786405, 0.0208852, -0.0337452, 0.00793121, -0.00659384,
        0.0931693, -0.0405073, 0.0159852, -0.00727745, -0.0791751,
        -0.0150893, -0.00465871, 0.0259633, -0.0108804, 2.4433e-05,
        -0.0225681, 0.0258566, -0.0348761, -0.0254534, -0.00739053,
        0.0943818, -0.0197703, 0.00298108, -0.00899099, -0.0713296,
        -0.0137983, 0.000699461, -0.0243173, -0.000887608, 0.00238308,
        -0.0124264, 0.00450711, -0.0221243, 0.00137662, -0.0224955
    ])},
    "opacity": 10.81027,
    "scale_0": -0.8,
    "scale_1": -0.8,
    "scale_2": -0.8,
    "rot_0": 0.510566,
    "rot_1": 0.502488,
    "rot_2": 0.00997789,
    "rot_3": -0.140544,
}

# -------------------------
# 2つ目のガウス（少しだけ変えたもの）
# -------------------------
g2 = g1.copy()
g2.update({
    "x": -0.5,
    "z": 0,
    "f_dc_0": 0.2,      # 赤み
    "f_dc_1": 2.0,      # 緑色
    "f_dc_2": 0.5,      # 青少なめ
    "opacity": 1.0,
    "scale_0": -0.2,
    "scale_1": -0.2,
    "scale_2": -0.2,
})

gaussians = [g1, g2]

# -------------------------
# プロパティリスト
# -------------------------
properties = [
    "x", "y", "z",
    "scale_0", "scale_1", "scale_2",
    "rot_0", "rot_1", "rot_2", "rot_3",
    "nx", "ny", "nz",
    "opacity",
    "f_dc_0", "f_dc_1", "f_dc_2",
] + [f"f_rest_{i}" for i in range(45)]

# -------------------------
# PLY ヘッダ
# -------------------------
header = f"""ply
format binary_little_endian 1.0
element vertex {len(gaussians)}
"""
for prop in properties:
    header += f"property float {prop}\n"
header += "end_header\n"

# -------------------------
# 書き込み
# -------------------------
with open("two_gaussians.ply", "wb") as f:
    f.write(header.encode('ascii'))
    for g in gaussians:
        for prop in properties:
            f.write(struct.pack('<f', g[prop]))

print("two_gaussians.ply を出力しました。")
